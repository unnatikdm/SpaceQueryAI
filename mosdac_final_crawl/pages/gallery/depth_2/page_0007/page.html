<html><head><meta name="color-scheme" content="light dark"></head><body><pre style="word-wrap: break-word; white-space: pre-wrap;">// satService to fetch satellite/sensor/product type/ Products based on filter

angular.module('satServiceService', [])
        .service("satService", ['$http', function($http) {
                var service = {};
                var senobj;
                var prodlist;
                var gpat;
                function getObjects(obj, key, val) {
                    var objects = [];
                    for (var i in obj) {
                        if (!obj.hasOwnProperty(i))
                            continue;
                        if (typeof obj[i] == 'object') {
                            objects = objects.concat(getObjects(obj[i], key, val));
                        } else
                        //if key matches and value matches or if key matches and value is not passed (eliminating the case where key matches but passed value does not)
                        if (i == key &amp;&amp; obj[i] == val || i == key &amp;&amp; val == '') { //
                            objects.push(obj);
                        } else if (obj[i] == val &amp;&amp; key == '') {
                            //only add if the object is not already in the array
                            if (objects.lastIndexOf(obj) == -1) {
                                objects.push(obj);
                            }
                        }
                    }
                    return objects;
                }

                function getParents(satobj, key, value) {

                    var result
                    for (i = 0; i &lt; satobj.length; i++) {
                        for (j = 0; j &lt; satobj[i].sensor.length; j++) {
                            for (k = 0; k &lt; satobj[i].sensor[j].type.length; k++) {
                                result = satobj[i].sensor[j].type[k].prodlist.filter(customfilter);
                                if (result.length &gt; 0) {
                                    return satobj[i];
                                    break;
                                }
                            }
                            if (result.length &gt; 0) {
                                break;
                            }
                        }
                        if (result.length &gt; 0) {
                            break;
                        }
                    }
                }

                function getParent(satobj, key, value) {
                    var result
//                    for (k = 0; k &lt; satobj.sensor[0].type.length; k++) {
//                        result = satobj.sensor[0].type[k].prodlist.filter(customfilter);
//                        if (result.length &gt; 0) {
//                            return satobj.sensor[0].type[k];
//                            break;
//                        }
//                    }
                    for (j = 0; j &lt; satobj.sensor.length; j++) {
                        for (k = 0; k &lt; satobj.sensor[j].type.length; k++) {
                            result = satobj.sensor[j].type[k].prodlist.filter(customfilter);
                            if (result.length &gt; 0) {
                                return satobj.sensor[j].type[k];
                                break;
                            }
                        }
                    }
                }

                function getGParent(satobj, key, value) {
                    var result
                    for (j = 0; j &lt; satobj.sensor.length; j++) {
                        for (k = 0; k &lt; satobj.sensor[j].type.length; k++) {
                            result = satobj.sensor[j].type[k].prodlist.filter(customfilter);
                            if (result.length &gt; 0) {
                                return satobj.sensor[j];
                                break;
                            }
                        }
                    }


                }

                function customfilter(item) {
                    if (item.pat == gpat) {
                        return true;
                    }
                    return false;
                }

                service.getProd = function($scope, pat) {
                    $http.get($scope.ds + "/config.json")
                            .then(function(response) {
                                $scope.conf = response.data;
                                $scope.color = $scope.conf.bgcolor;
//                                $scope.count = $scope.conf.count;
                                if ($scope.count == "" || $scope.count == null || $scope.count == "undefined")
                                {
                                    $scope.count = $scope.conf.count;
                                }
                                // $scope.switch = $scope.conf.autoload;
                                document.getElementById('switch').checked = $scope.conf.autoload;
                                document.getElementById('msg').style.backgroundColor = $scope.color;
                                document.body.style.backgroundColor = $scope.color;
                                document.getElementById('filename_id').style.backgroundColor = $scope.color;
                                document.getElementById('filename_id').style.color = $scope.conf.bgheaderfontcolor;
                                document.getElementById('abbr').style.color = $scope.conf.bgheaderfontcolor;
                                document.getElementById('prod').selected = $scope.count;
                            });
                    $http.get($scope.ds + "/product.json?v=0.19")
                            .then(function(response) {
                                $scope.complist = response.data;
                                $scope.sat = [];
                                $scope.sen = [];
                                $scope.prodt = [];
                                $scope.prod = [];
                                gpat = pat
                                satobj = getParents($scope.complist, 'pat', pat);
                                for (i = 0; i &lt; $scope.complist.length; i++) {
                                    $scope.sat.push($scope.complist[i].sat);
                                }
                                $scope.product = satobj.sat;
                                senobj = getObjects($scope.complist, 'sat', $scope.product);
                                for (i = 0; i &lt; senobj[0].sensor.length; i++) {
                                    $scope.sen.push(senobj[0].sensor[i].sen);
                                }
                                seobj = getGParent(satobj, 'pat', pat);
                                $scope.sensor = seobj.sen;
                                for (i = 0; i &lt; seobj.type.length; i++) {
                                    $scope.prodt.push(seobj.type[i].prodt);
                                }
                                sobj = getParent(satobj, 'pat', pat);
                                $scope.productt = sobj.prodt;
                                for (i = 0; i &lt; sobj.prodlist.length; i++) {
                                    $scope.prod.push(sobj.prodlist[i]);
                                    if (sobj.prodlist[i].pat == pat)
                                    {
                                        $scope.product1 = sobj.prodlist[i];
                                    }
                                }
                                //$scope.product1 = getObjects($scope.complist, 'pat', pat)[0];
                                $scope.load();
                                $scope.addAlert();

                            });

                };

                service.getSat = function($scope) {
                    //  console.log('getSat called')
                    $http.get($scope.ds + "/config.json")
                            .then(function(response) {
                                $scope.conf = response.data;
                                $scope.color = $scope.conf.bgcolor;
//                                $scope.count = $scope.conf.count;
                                // $scope.switch = $scope.conf.autoload;
                                //   console.log($scope.switch + '$scope.switch');
                                if ($scope.count == "" || $scope.count == null || $scope.count == "undefined")
                                {
                                    $scope.count = $scope.conf.count;
                                }
                                document.getElementById('switch').checked = $scope.conf.autoload;
                                document.getElementById('msg').style.backgroundColor = $scope.color;
                                document.body.style.backgroundColor = $scope.color;
                                document.getElementById('filename_id').style.backgroundColor = $scope.color;
                                document.getElementById('filename_id').style.color = $scope.conf.bgheaderfontcolor;
                                document.getElementById('abbr').style.color = $scope.conf.bgheaderfontcolor;
                                document.getElementById('prod').selected = $scope.count;

                                $http.get($scope.ds + "/product.json?v=0.19")
                                        .then(function(response) {
                                            $scope.complist = response.data;
                                            $scope.sat = [];
                                            $scope.sen = [];
                                            $scope.prodt = [];
                                            $scope.prod = [];
                                            for (i = 0; i &lt; $scope.complist.length; i++) {
                                                $scope.sat.push($scope.complist[i].sat);
                                            }
                                            $scope.product = $scope.sat[0];
                                            senobj = getObjects($scope.complist, 'sat', $scope.sat[0]);
                                            for (i = 0; i &lt; senobj[0].sensor.length; i++) {
                                                $scope.sen.push(senobj[0].sensor[i].sen);
                                            }
                                            $scope.sensor = $scope.sen[0];
                                            for (i = 0; i &lt; senobj[0].sensor[0].type.length; i++) {
                                                $scope.prodt.push(senobj[0].sensor[0].type[i].prodt);
                                            }
                                            $scope.productt = $scope.prodt[0];

                                            for (i = 0; i &lt; senobj[0].sensor[0].type[0].prodlist.length; i++) {
                                                $scope.prod.push(senobj[0].sensor[0].type[0].prodlist[i]);
                                            }
                                            $scope.product1 = $scope.prod[0];
                                            $scope.load();
                                            $scope.addAlert();
                                        });


                            });

                };

                service.satChange = function($scope) {
                    $scope.sen = [];
                    $scope.prodt = [];
                    $scope.prod = [];
                    senobj = getObjects($scope.complist, 'sat', $scope.product);
                    console.log('senobj.length'+senobj.length+'$scope.product'+$scope.product);
                   
                    /*for (i = 0; i &lt; senobj.length; i++) {
                        $scope.sen.push(senobj[i].sensor[i].sen);
                        console.log('senobj.length'+senobj[i].sensor[i].sen);
                    }*/

                    for (i = 0; i &lt; senobj[0].sensor.length; i++) {
                        $scope.sen.push(senobj[0].sensor[i].sen);
                    }
                                        
                    $scope.sensor = $scope.sen[0];
                    for (i = 0; i &lt; senobj[0].sensor[0].type.length; i++) {
                        $scope.prodt.push(senobj[0].sensor[0].type[i].prodt);
                    }
                    $scope.productt = $scope.prodt[0];

                    for (i = 0; i &lt; senobj[0].sensor[0].type[0].prodlist.length; i++) {
                        $scope.prod.push(senobj[0].sensor[0].type[0].prodlist[i]);
                    }
                    $scope.product1 = $scope.prod[0];
                }

                service.senChange = function($scope) {
                    $scope.prodt = [];
                    $scope.prod = [];
                    var senlist = getObjects(senobj, 'sen', $scope.sensor);
//                    console.log(senlist);
                    for (i = 0; i &lt; senlist[0].type.length; i++) {
                        $scope.prodt.push(senlist[0].type[i].prodt);
                    }
                    $scope.productt = $scope.prodt[0];

                    // prodlist = getObjects(senobj, 'prodt', $scope.productt);
                    for (i = 0; i &lt; senlist[0].type[0].prodlist.length; i++) {
                        $scope.prod.push(senlist[0].type[0].prodlist[i]);
                    }
                    $scope.product1 = $scope.prod[0];
                }

                service.prodtChange = function($scope) {
                    $scope.prod = [];
                    prodlist = getObjects(senobj, 'prodt', $scope.productt);
                    for (i = 0; i &lt; prodlist[0].prodlist.length; i++) {
                        $scope.prod.push(prodlist[0].prodlist[i]);
                    }
                    $scope.product1 = $scope.prod[0];
                }

                service.getNextProd = function($scope, pat) {
                    for (k = 0; k &lt; $scope.prod.length; k++) {
                        if ($scope.prod[k].pat == pat)
                        {
                            break;
                        }
                    }
                    if (k == $scope.prod.length - 1)
                        $scope.product1 = $scope.prod[k];
                    else
                        $scope.product1 = $scope.prod[k + 1];
                }

                service.getPrevProd = function($scope, pat) {
                    for (k = 0; k &lt; $scope.prod.length; k++) {
                        if ($scope.prod[k].pat == pat)
                        {
                            break;
                        }
                    }
                    if (k == 0)
                        $scope.product1 = $scope.prod[k];
                    else
                        $scope.product1 = $scope.prod[k - 1];
                }


                return service;
            }]);
</pre></body></html>